<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Diagnostic Agent Tester</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; }
    #log { border:1px solid #ddd; padding:10px; height: 60vh; overflow:auto; }
    .user { color:#0b6; margin:6px 0; }
    .agent { color:#06b; margin:6px 0; white-space: pre-wrap;}
    input,button { font-size:16px; }
  </style>
</head>
<body>
  <h1>Diagnostic Agent Tester</h1>
  <div>
    <label>Session ID:</label>
    <input id="sid" value="web1" />
    <button onclick="reset()">Reset</button>
  </div>
  <div id="log"></div>
  <form onsubmit="send(event)">
    <input id="msg" placeholder="Type a message..." size="60" autofocus />
    <button>Send</button>
  </form>

  <hr>
  <h3>Upload artifact</h3>
  <input id="file" type="file" />
  <button onclick="up()">Upload</button>

  <script>
    const log = document.getElementById('log');
    const sid = document.getElementById('sid');
    const msg = document.getElementById('msg');

    function line(cls, text) {
      const div = document.createElement('div');
      div.className = cls;
      div.textContent = text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    async function send(e) {
      e?.preventDefault?.();
      const text = msg.value.trim();
      if (!text) return;
      line('user', `You: ${text}`);
      msg.value = '';
      const res = await fetch('/agent', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ text, sessionId: sid.value })
      });
      const data = await res.json();
      line('agent', `Agent: ${JSON.stringify(data, null, 2)}`);
    }

    async function reset() {
      const res = await fetch('/agent', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ text: 'reset', sessionId: sid.value })
      });
      const data = await res.json();
      line('agent', `Reset â†’ ${JSON.stringify(data)}`);
    }

    async function up() {
      const f = document.getElementById('file').files[0];
      if (!f) return alert('Pick a file');
      const fd = new FormData();
      fd.append('file', f);
      const res = await fetch('/upload', { method:'POST', body: fd });
      const data = await res.json();
      line('agent', `Uploaded: ${data.artifactId}`);
      const r2 = await fetch('/agent', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ text: 'uploaded', sessionId: sid.value, artifactId: data.artifactId })
      });
      const d2 = await r2.json();
      line('agent', `Agent: ${JSON.stringify(d2, null, 2)}`);
    }
  </script>
</body>
</html>

